<div id="central-widget"></div>

<!-- n8n chat styles -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" />

<style>
  /* Fill our module and hide the floating bubble */
  #central-widget .n8n-chat { position:absolute; inset:0; }
  #central-widget .chat-toggle { display:none !important; }
</style>

<script>
(function () {
  const el = document.getElementById("central-widget");
  if (!el) return;

  // ── CONFIG ───────────────────────────────────────────────────────────────────
  const webhookUrl = "https://brd.app.n8n.cloud/webhook/60360755-53ae-4fc2-be23-7ad01e8e66c2"; // <-- no /chat

  // ── SHELL (fixed height so fullscreen has somewhere to live) ─────────────────
  el.innerHTML = `
    <div style="width:min(900px,92vw);height:640px;margin:4rem auto;border-radius:16px;overflow:hidden;box-shadow:0 24px 60px rgba(0,0,0,.35);background:#0b0f1a;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;">
      <div style="display:flex;align-items:center;gap:8px;padding:12px 14px;background:linear-gradient(90deg,#6a11cb,#2575fc);">
        <div style="font-weight:700">Interactive Assistant</div>
      </div>
      <div id="stage" style="position:relative;height:calc(100% - 52px)">
        <div id="n8n-mount" style="position:absolute;inset:0;"></div>
        <div id="err" style="display:none;position:absolute;left:12px;right:12px;bottom:12px;background:#2b1b1b;color:#ffd4d4;border:1px solid #a33;border-radius:10px;padding:10px 12px;font-size:13px"></div>
      </div>
    </div>
  `;

  const err = el.querySelector("#err");
  const showError = (m) => { err.textContent = m; err.style.display = "block"; };

  // ── Load the SDK and mount in FULLSCREEN mode ────────────────────────────────
  const s = document.createElement("script");
  s.type = "module";
  s.textContent = `
    import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';

    const opts = {
      webhookUrl: ${JSON.stringify(webhookUrl)},
      target: '#n8n-mount',
      mode: 'fullscreen',          // fills #n8n-mount
      showWelcomeScreen: true,     // shows input immediately; you can set false later
      defaultLanguage: 'en',
      initialMessages: []
    };

    try {
      createChat(opts);
    } catch {
      // Fallback for older builds that use containerSelector
      createChat({ ...opts, containerSelector: '#n8n-mount' });
    }
  `;
  s.onerror = () => {
    showError("Could not load @n8n/chat. Check CSP (allow cdn.jsdelivr.net and inline module scripts) and that your Chat Trigger’s Allowed Origin includes this page.");
  };
  document.body.appendChild(s);
})();
</script>
